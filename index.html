<!DOCTYPE html>
<html lang="en">
  <head profile="http://www.w3.org/2005/10/profile">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="./favicon.ico">

    <title>Starter Template for Bootstrap</title>

    <link rel="stylesheet" href="https://cartodb-libs.global.ssl.fastly.net/cartodb.js/v3/themes/css/cartodb.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">

    <link rel="icon" type="image/png" href="./favicon.png">
  </head>

  <style>
/*    html, body, #container {
      height: 100%;
      width: 100%;
      overflow: hidden;
    }*/

   /* body {
      padding-top: 50px;
    }*/

    #map {
      width: auto;
      height: 500px;
    }

  </style>

  <body>

    <div class="container">
      <h3>Which Countries Care About Which SDG?</h3>
      <p>Click dropdown menu to explore the data. This map shows countries ranked by normalized Google search volumes
for each issue over past 12 months</p>
      <div class="col-md-3">
        <form>
          <div class="form-group">
            <select id="selector" class="form-control" >
            </select>
          </div>
        </form>
      </div>
    </div>

    <div id="container">
      
      <div id="map">
      </div>

    </div><!-- /.container -->

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
     <script src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>
    <script src="https://cartodb-libs.global.ssl.fastly.net/cartodb.js/v3/3.13/cartodb.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script>



    // var map = new L.Map('map', { 
    //   center: [20,0],
    //   zoom: 2
    // });

    var map = new google.maps.Map(document.getElementById('map'), {
                    center: new google.maps.LatLng(20, 0),
                    zoom: 2,
                    mapTypeId: google.maps.MapTypeId.ROADMAP
                });

    // L.tileLayer('https://dnv9my2eseobd.cloudfront.net/v3/cartodb.map-4xtxp73f/{z}/{x}/{y}.png', {
    //   attribution: 'Mapbox <a href="http://mapbox.com/about/maps" target="_blank">Terms &amp; Feedback</a>'
    // }).addTo(map);

    //var googleLayer = new L.Google('ROADMAP').addTo(map);

    var layerUrl = 'https://srogers.cartodb.com/api/v2/viz/2bde27bc-0576-11e5-ba27-0e4fddd5de28/viz.json';

    cartodb.createLayer(map, layerUrl)
      .addTo(map)
      .on('done', function(layer) {
        console.log(layer);
        layer.layers.forEach(function(subLayer,i) {
          var name = subLayer.layer_name;
          $('#selector').append('<option value = "' + i + '"">' + name + '</option>')
        })

        var subLayers = layer.getSubLayers();
      
        //hide all but layer 0;  
        hideSubLayers(0);

        $('#selector').change(function(){
          console.log('changed');
          var v = this.value;
          //turn all layers off
          hideSubLayers();
          //turn on this layer
          showSubLayer(v);
        });

        //hide all sublayers, if v is passed, hide all but v
        function hideSubLayers(v) {
          subLayers.forEach(function(s,i) {
            if (i!=v) {
              s.hide(); 
            }
          });
        }

        function showSubLayer(v) {
          console.log('showing',v);
          layer.getSubLayer(v).show();
        }

        // console.log(layer.getSubLayer(0));
        // layer.getSubLayer(1).hide();
        // layer.getSubLayer(2).hide();
        // layer.getSubLayer(0).hide();
      }).on('error', function() {
        //log the error
      });

    </script>
  </body>
</html>
