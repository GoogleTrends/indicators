<!DOCTYPE html>
<html lang="en">
  <head profile="http://www.w3.org/2005/10/profile">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="./favicon.ico">

    <title>Starter Template for Bootstrap</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cartodb-libs.global.ssl.fastly.net/cartodb.js/v3/themes/css/cartodb.css" />


    <link rel="icon" type="image/png" href="./favicon.png">
  </head>

  <style>
    html, body, #container {
      height: 100%;
      width: 100%;
      overflow: hidden;
    }

   /* body {
      padding-top: 50px;
    }*/

    #map {
      width: auto;
      height: 100%;
    }

    div.cartodb-share a {
      box-sizing:content-box;
    }

    .list-group {
      position: absolute;
      top: 32px;
      right: 18px;
      width: 248px;
      webkit-box-shadow: rgba(0, 0, 0, 0.2) 0 0 4px 2px;
      -moz-box-shadow: rgba(0, 0, 0, 0.2) 0 0 4px 2px;
      box-shadow: rgba(0, 0, 0, 0.2) 0 0 4px 2px;
    }

  </style>

  <body>



    <div id="container">
      
      <div id="map">
      </div>
      <ul class="list-group">
      </ul>
    </div><!-- /.container -->

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
     <script src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>
    <script src="https://cartodb-libs.global.ssl.fastly.net/cartodb.js/v3/3.13/cartodb.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script>



    // var map = new L.Map('map', { 
    //   center: [20,0],
    //   zoom: 2
    // });

    var map = new google.maps.Map(document.getElementById('map'), {
                    center: new google.maps.LatLng(20, 0),
                    zoom: 2,
                    mapTypeId: google.maps.MapTypeId.ROADMAP
                });

    // L.tileLayer('https://dnv9my2eseobd.cloudfront.net/v3/cartodb.map-4xtxp73f/{z}/{x}/{y}.png', {
    //   attribution: 'Mapbox <a href="http://mapbox.com/about/maps" target="_blank">Terms &amp; Feedback</a>'
    // }).addTo(map);

    //var googleLayer = new L.Google('ROADMAP').addTo(map);

    var layerUrl = 'https://googledataorg.cartodb.com/u/googledata/api/v2/viz/e11e398c-060c-11e5-b348-42010a14cb63/viz.json';


    // cartodb.createVis('map', layerUrl,{
    //   shareable:true
    // })
    //   .done(function(vis, layers) {
    // });


    cartodb.createLayer(map, layerUrl)
      .addTo(map)
      .on('done', function(layer) {
        console.log(layer);
        layer.layers.forEach(function(subLayer,i) {
          var name = subLayer.layer_name;
          $('.list-group').append('<a href="#" class="list-group-item">' + name + '</a>')
        })


        $('.list-group a').first().addClass('active');

        var subLayers = layer.getSubLayers();
      
        //hide all but layer 0;  
        hideSubLayers(0);

        $('.list-group a').click(function() {
          var i = $(this).index();
          //turn all layers off
          hideSubLayers();
          $('.list-group .active').removeClass('active');
          //turn on this layer
          showSubLayer(i);
          $(this).addClass('active');
        });


        $('#selector').change(function(){
          console.log('changed');
          var v = this.value;
          //turn all layers off
          hideSubLayers();
          //turn on this layer
          showSubLayer(v);
        });

        //hide all sublayers, if v is passed, hide all but v
        function hideSubLayers(v) {
          subLayers.forEach(function(s,i) {
            if (i!=v) {
              s.hide(); 
            }
          });
        }

        function showSubLayer(v) {
          console.log('showing',v);
          layer.getSubLayer(v).show();
        }

        // console.log(layer.getSubLayer(0));
        // layer.getSubLayer(1).hide();
        // layer.getSubLayer(2).hide();
        // layer.getSubLayer(0).hide();
      }).on('error', function() {
        //log the error
      });

    </script>
  </body>
</html>
